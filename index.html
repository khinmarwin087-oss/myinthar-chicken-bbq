<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYIN THAR ROAST - All-in-One System</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* (á‚) á€¡á€›á€±á€¬á€„á€ºá€”á€¾á€„á€·á€º á€¡á€•á€¼á€„á€ºá€¡á€†á€„á€º (CSS Styles) */
        :root { --gold: #D4AF37; --dark: #121212; --orange: #ff6b00; --bg: #f8f9fa; }
        body { font-family: 'Pyidaungsu', sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; }
        
        .header { background: var(--dark); color: white; padding: 15px; display: flex; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .burger { font-size: 24px; cursor: pointer; color: var(--gold); margin-right: 15px; }

        .sidebar { height: 100%; width: 0; position: fixed; z-index: 2001; top: 0; left: 0; background: var(--dark); overflow-x: hidden; transition: 0.3s; }
        .sidebar a { padding: 15px 25px; text-decoration: none; font-size: 16px; color: white; display: block; border-bottom: 1px solid #333; }
        .overlay { display: none; position: fixed; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; top:0; }

        .container { padding: 10px; }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .menu-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .menu-card img { width: 100%; height: 120px; object-fit: cover; }
        
        .section { display: none; }
        .section.active { display: block; }
        
        .footer-bar { position: fixed; bottom: 0; width: 100%; max-width: 600px; background: var(--dark); padding: 15px; display: flex; justify-content: space-between; align-items: center; color: white; left: 50%; transform: translateX(-50%); z-index: 1001; border-radius: 20px 20px 0 0; }
        
        .admin-form input, .admin-form select, .admin-form textarea { width: 100%; padding: 10px; margin: 5px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        .btn { border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; }
    </style>
</head>
<body>

<div id="overlay" class="overlay" onclick="closeNav()"></div>
<div id="mySidebar" class="sidebar">
    <div style="padding:20px; color:var(--gold); font-weight:bold;">MANAGEMENT</div>
    <a href="#" onclick="showPage('customer')">ğŸ— á€™á€®á€”á€°á€¸á€™á€¾á€¬á€šá€°á€›á€”á€º</a>
    <a href="#" onclick="showPage('admin')">âš™ï¸ Admin Dashboard</a>
    <a href="#" onclick="showPage('tracking')">ğŸ“ á€¡á€±á€¬á€ºá€’á€«á€…á€…á€ºá€†á€±á€¸á€›á€”á€º</a>
</div>

<div class="header">
    <div class="burger" onclick="openNav()">â˜°</div>
    <div>MYIN THAR ROAST</div>
</div>

<div class="container">
    
    <div id="page-customer" class="section active">
        <div style="display:flex; overflow-x:auto; gap:10px; padding:10px 0;">
            <button class="btn" onclick="filterMenu('all')" style="width:auto; background:var(--dark); color:white;">á€¡á€¬á€¸á€œá€¯á€¶á€¸</button>
            <button class="btn" onclick="filterMenu('10000_set')" style="width:auto; background:white;">áá€á€±á€¬á€„á€ºá€¸ Set</button>
            <button class="btn" onclick="filterMenu('20000_set')" style="width:auto; background:white;">á‚á€á€±á€¬á€„á€ºá€¸ Set</button>
        </div>
        <div id="menu-display" class="menu-grid">á€™á€®á€”á€°á€¸á€™á€»á€¬á€¸ á€†á€½á€²á€šá€°á€”á€±á€á€Šá€º...</div>
    </div>

    <div id="page-admin" class="section">
        <div class="admin-form" style="background:#fff; padding:15px; border-radius:10px;">
            <h3 style="margin:0;">â• á€™á€®á€”á€°á€¸á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€›á€”á€º</h3>
            <input type="text" id="add-name" placeholder="á€™á€®á€”á€°á€¸á€¡á€™á€Šá€º">
            <input type="number" id="add-price" placeholder="á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸">
            <select id="add-cat">
                <option value="single">á€›á€­á€¯á€¸á€›á€­á€¯á€¸ (Single)</option>
                <option value="10000_set">áá€á€±á€¬á€„á€ºá€¸á€á€”á€º Set</option>
                <option value="20000_set">á‚á€á€±á€¬á€„á€ºá€¸á€á€”á€º Set</option>
            </select>
            <textarea id="add-desc" placeholder="Set á€‘á€²á€á€½á€„á€º á€•á€«á€á€„á€ºá€á€Šá€ºá€™á€»á€¬á€¸ (á€¡á€á€±á€¸á€…á€­á€á€º)"></textarea>
            <input type="file" id="add-img" accept="image/*">
            <button class="btn" style="background:green; color:white;" onclick="uploadMenu()">á€á€­á€™á€ºá€¸á€™á€Šá€º (Upload)</button>
        </div>
        <hr>
        <h3>ğŸ“‹ á€œá€€á€ºá€›á€¾á€­á€™á€®á€”á€°á€¸á€™á€»á€¬á€¸</h3>
        <div id="admin-menu-list"></div>
    </div>

    <div id="page-tracking" class="section">
        <div style="background:white; padding:15px; border-radius:10px;">
            <h3>ğŸ“ á€¡á€±á€¬á€ºá€’á€«á€¡á€á€¼á€±á€¡á€”á€±</h3>
            <input type="number" id="track-id" placeholder="Order ID á€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«" style="width:100%; padding:10px; margin-bottom:10px;">
            <button class="btn" style="background:var(--dark); color:white;" onclick="trackOrder()">á€…á€…á€ºá€†á€±á€¸á€™á€Šá€º</button>
            <div id="track-result" style="margin-top:20px;"></div>
        </div>
    </div>

</div>

<div class="footer-bar">
    <div>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸: <b id="total-price" style="color:var(--gold);">0</b> K</div>
    <button onclick="openCheckout()" style="background:var(--gold); border:none; padding:10px 20px; border-radius:8px; font-weight:bold;">á€™á€¾á€¬á€™á€Šá€º</button>
</div>

<div id="checkout-modal" class="modal">
    <div class="modal-content">
        <h3>ğŸ“‹ á€¡á€±á€¬á€ºá€’á€«á€á€„á€ºá€›á€”á€º</h3>
        <input type="text" id="cust-name" placeholder="á€¡á€™á€Šá€º">
        <input type="tel" id="cust-phone" placeholder="á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º">
        <input type="datetime-local" id="pickup-time">
        <button class="btn" style="background:#7360f2; color:white; margin-bottom:10px;" onclick="submitOrder('viber')">Viber á€á€­á€¯á€·á€•á€­á€¯á€·á€™á€Šá€º (Copy á€šá€°á€™á€Šá€º)</button>
        <button class="btn" style="background:#0088cc; color:white;" onclick="submitOrder('telegram')">Telegram á€á€­á€¯á€·á€•á€­á€¯á€·á€™á€Šá€º</button>
        <button class="btn" style="background:none; color:gray;" onclick="closeModal('checkout-modal')">á€•á€­á€á€ºá€™á€Šá€º</button>
    </div>
</div>

<div id="voucher-modal" class="modal">
    <div class="modal-content" style="text-align:center;">
        <div id="invoice-card" style="padding:20px; background:white; border:1px solid #eee;">
            <h2 style="margin:0;">MYIN THAR ROAST</h2>
            <p>Order Voucher</p>
            <hr>
            <div id="invoice-text" style="text-align:left; font-size:14px;"></div>
            <hr>
            <h3>Total: <span id="invoice-total"></span> K</h3>
        </div>
        <button class="btn" style="background:orange; margin-top:10px;" onclick="downloadVoucher()">á€“á€¬á€á€ºá€•á€¯á€¶á€á€­á€™á€ºá€¸á€™á€Šá€º (Download)</button>
        <button class="btn" style="background:none;" onclick="closeModal('voucher-modal')">á€•á€­á€á€ºá€™á€Šá€º</button>
    </div>
</div>

<script>
    // (áá€) Database á€á€»á€­á€á€ºá€†á€€á€ºá€™á€¾á€¯ (Supabase)
    const SB_URL = "https://iogpnvljnhsxuzzdltpb.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvZ3BudmxqbmhzeHV6emRsdHBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NTk2MDYsImV4cCI6MjA4MjMzNTYwNn0.Kxy3QW1gq-J-tzUF2fxQd0l989Wr7BI2uRTbWDTNL6k";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    let allMenuItems = [];
    let cart = {};

    window.onload = fetchMenu;

    // (áá) Navigation Logic
    function openNav() { document.getElementById("mySidebar").style.width = "260px"; document.getElementById("overlay").style.display = "block"; }
    function closeNav() { document.getElementById("mySidebar").style.width = "0"; document.getElementById("overlay").style.display = "none"; }
    function showPage(p) { 
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('page-'+p).classList.add('active');
        closeNav();
        if(p === 'admin') fetchAdminMenu();
    }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    // (áá‚) Menu Functions
    async function fetchMenu() {
        const { data } = await _supabase.from('menu_items').select('*').order('created_at', {ascending: false});
        allMenuItems = data || [];
        renderMenu(allMenuItems);
    }

    function renderMenu(items) {
        const grid = document.getElementById('menu-display');
        grid.innerHTML = items.map(item => `
            <div class="menu-card" onclick="showItemDetail('${item.name}', '${item.description || 'á€¡á€á€±á€¸á€…á€­á€á€ºá€™á€›á€¾á€­á€•á€«'}')">
                <img src="${item.image_url || 'https://via.placeholder.com/150'}">
                <div style="padding:10px;">
                    <div style="font-weight:bold; font-size:14px;">${item.name}</div>
                    <div style="color:var(--orange); font-weight:bold;">${item.price.toLocaleString()} K</div>
                    <div style="display:flex; align-items:center; justify-content:space-between; margin-top:5px; background:#f0f0f0; border-radius:5px; padding:2px;">
                        <button onclick="event.stopPropagation(); updateQty('${item.name}', -1, ${item.price})" style="border:none; background:white; width:25px;">-</button>
                        <span id="qty-${item.name}">0</span>
                        <button onclick="event.stopPropagation(); updateQty('${item.name}', 1, ${item.price})" style="border:none; background:white; width:25px;">+</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function showItemDetail(name, desc) {
        alert("ğŸ¥— " + name + "\n\ná€•á€«á€á€„á€ºá€•á€…á€¹á€…á€Šá€ºá€¸á€™á€»á€¬á€¸ - " + desc);
    }

    function updateQty(name, change, price) {
        cart[name] = (cart[name] || 0) + change;
        if (cart[name] < 0) cart[name] = 0;
        document.getElementById(`qty-${name}`).innerText = cart[name];
        updateTotal();
    }

    function updateTotal() {
        let total = 0;
        allMenuItems.forEach(item => { if(cart[item.name]) total += cart[item.name] * item.price; });
        document.getElementById('total-price').innerText = total.toLocaleString();
    }

    function filterMenu(cat) {
        if(cat === 'all') renderMenu(allMenuItems);
        else renderMenu(allMenuItems.filter(i => i.category === cat));
    }

    // (ááƒ) á€™á€¾á€¬á€šá€°á€á€¼á€„á€ºá€¸á€”á€¾á€„á€·á€º Voucher Logic
    function openCheckout() { document.getElementById('checkout-modal').style.display = 'flex'; }

    async function submitOrder(platform) {
        const name = document.getElementById('cust-name').value;
        const phone = document.getElementById('cust-phone').value;
        const pickup = document.getElementById('pickup-time').value;
        const total = document.getElementById('total-price').innerText;

        if(!name || !phone) return alert("á€¡á€™á€Šá€ºá€”á€¾á€„á€·á€ºá€–á€¯á€”á€ºá€¸ á€–á€¼á€Šá€·á€ºá€•á€«");

        let items = [];
        for (let k in cart) { if(cart[k] > 0) items.push(`${k} (${cart[k]}á€á€¯)`); }

        const { data, error } = await _supabase.from('orders').insert([{
            customer_name: name, phone: phone, items: items.join(", "), total: total, status: 'pending'
        }]).select();

        if(!error) {
            const orderId = data[0].id;
            const msg = `ğŸ†” Order: #${orderId}\nğŸ‘¤ á€á€šá€ºá€á€°: ${name}\nğŸ“ á€–á€¯á€”á€ºá€¸: ${phone}\nâ° á€¡á€á€»á€­á€”á€º: ${pickup}\nğŸ“¦ á€•á€…á€¹á€…á€Šá€ºá€¸: ${items.join(", ")}\nğŸ’° á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸: ${total} K`;

            if(platform === 'viber') {
                navigator.clipboard.writeText(msg);
                alert("Viber á€á€­á€¯á€· á€…á€¬á€á€¬á€¸á€€á€°á€¸á€šá€°á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹");
                window.location.href = `viber://forward?text=${encodeURIComponent(msg)}`;
            } else {
                window.location.href = `https://t.me/959767287345?text=${encodeURIComponent(msg)}`;
            }
            showVoucherUI(orderId, name, items.join("<br>"), total);
        }
    }

    function showVoucherUI(id, name, items, total) {
        document.getElementById('invoice-text').innerHTML = `<b>ID:</b> #${id}<br><b>Name:</b> ${name}<br><br>${items}`;
        document.getElementById('invoice-total').innerText = total;
        document.getElementById('voucher-modal').style.display = 'flex';
    }

    function downloadVoucher() {
        html2canvas(document.querySelector("#invoice-card")).then(canvas => {
            const link = document.createElement('a');
            link.download = `Voucher.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    // (áá„) Admin Logic (Add/Delete/Upload)
    async function uploadMenu() {
        const file = document.getElementById('add-img').files[0];
        const name = document.getElementById('add-name').value;
        const price = document.getElementById('add-price').value;
        const cat = document.getElementById('add-cat').value;
        const desc = document.getElementById('add-desc').value;

        if(!file || !name || !price) return alert("á€¡á€€á€¯á€”á€ºá€–á€¼á€Šá€·á€ºá€•á€«");

        const fileName = Date.now() + "_" + file.name;
        const { data: imgData } = await _supabase.storage.from('menu_images').upload(fileName, file);
        const { data: publicUrl } = _supabase.storage.from('menu_images').getPublicUrl(fileName);

        await _supabase.from('menu_items').insert([{
            name: name, price: price, category: cat, description: desc, image_url: publicUrl.publicUrl
        }]);

        alert("á€™á€®á€”á€°á€¸á€‘á€Šá€·á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®");
        fetchMenu();
        fetchAdminMenu();
    }

    async function fetchAdminMenu() {
        const { data } = await _supabase.from('menu_items').select('*');
        const list = document.getElementById('admin-menu-list');
        list.innerHTML = data.map(i => `
            <div style="background:white; padding:10px; margin-bottom:5px; display:flex; justify-content:space-between; align-items:center; border-radius:8px;">
                <span>${i.name} (${i.price} K)</span>
                <button onclick="deleteMenu(${i.id})" style="background:red; color:white; border:none; border-radius:5px; padding:5px 10px;">á€–á€»á€€á€ºá€™á€Šá€º</button>
            </div>
        `).join('');
    }

    async function deleteMenu(id) {
        if(confirm("á€–á€»á€€á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) {
            await _supabase.from('menu_items').delete().eq('id', id);
            fetchAdminMenu();
            fetchMenu();
        }
    }

    // (áá…) Tracking Logic
    async function trackOrder() {
        const id = document.getElementById('track-id').value;
        const { data } = await _supabase.from('orders').select('*').eq('id', id).single();
        const res = document.getElementById('track-result');
        if(data) {
            res.innerHTML = `<div style="padding:15px; background:white; border-left:5px solid green;">
                <b>Order #${data.id} Status:</b> <span style="color:orange;">${data.status}</span><br>
                á€á€šá€ºá€á€°: ${data.customer_name}<br>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸: ${data.total} K
            </div>`;
        } else { res.innerHTML = "âŒ á€™á€á€½á€±á€·á€•á€«á‹"; }
    }
</script>
</body>
</html>

