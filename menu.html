<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YNS Menu Editor</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --pearl: #ffffff; --bg: #F2F2F7; --primary: #007AFF; --text: #1C1C1E; --gray: #8E8E93; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 10px 5px; }
        .add-btn { background: var(--primary); color: white; border: none; padding: 10px 18px; border-radius: 12px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; }

        /* Form Section */
        #form-container { display: none; background: var(--pearl); border-radius: 20px; padding: 20px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .form-group { margin-bottom: 12px; }
        label { font-size: 11px; font-weight: 700; color: var(--gray); margin-bottom: 5px; display: block; }
        input { width: 100%; padding: 12px; border: 1px solid #E5E5EA; border-radius: 10px; font-size: 15px; box-sizing: border-box; }
        .save-btn { background: var(--primary); color: white; border: none; width: 100%; padding: 14px; border-radius: 10px; font-weight: 700; margin-top: 10px; }
        .cancel-btn { background: none; border: none; color: #FF3B30; width: 100%; padding: 10px; font-weight: 600; cursor: pointer; }

        /* Menu List */
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        .menu-item { display: flex; align-items: center; background: var(--pearl); padding: 12px; border-radius: 16px; gap: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .menu-img { width: 55px; height: 55px; border-radius: 10px; object-fit: cover; background: #eee; }
        .menu-info { flex: 1; }
        .menu-name { font-weight: 700; font-size: 15px; }
        .menu-price { color: var(--primary); font-weight: 700; font-size: 14px; }
        .menu-meta { font-size: 11px; color: var(--gray); }
        .actions { display: flex; gap: 15px; padding-right: 5px; }
        .actions i { font-size: 18px; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">
    <div style="display: flex; align-items: center; gap: 10px;">
        <a href="admin.html" style="text-decoration: none; background: #E5E5EA; color: var(--text); padding: 8px 12px; border-radius: 10px; font-size: 13px; font-weight: 700; display: flex; align-items: center; gap: 5px;">
            <i class="fas fa-chevron-left"></i> Dashboard
        </a>
        <h2 style="margin:0;">Menus</h2>
    </div>
    <button class="add-btn" onclick="toggleForm()"><i class="fas fa-plus"></i> Add Menu</button>
</div>

<div id="form-container">
    <h3 id="form-title" style="margin-top:0;">ဟင်းပွဲအသစ်ထည့်ရန်</h3>
    <input type="hidden" id="edit-id">
    <div class="form-group"><label>ဟင်းပွဲအမည်</label><input type="text" id="mName" placeholder="Dish Name"></div>
    <div style="display:flex; gap:10px;">
        <div class="form-group" style="flex:1;"><label>ဈေးနှုန်း (Ks)</label><input type="number" id="mPrice" placeholder="Price"></div>
        <div class="form-group" style="flex:1;"><label>လက်ကျန် (Stock)</label><input type="number" id="mStock" placeholder="Stock"></div>
    </div>
    <div class="form-group"><label>အမျိုးအစား</label><input type="text" id="mCat" placeholder="Category"></div>
    <div class="form-group"><label>ပုံ Link (Image URL)</label><input type="text" id="mImg" placeholder="https://..."></div>
    <button class="save-btn" onclick="saveMenu()">SAVE</button>
    <button class="cancel-btn" onclick="toggleForm()">CANCEL</button>
</div>

<div class="menu-grid" id="menu-list-container">
    <p style="text-align:center; color:gray;">Loading Menus...</p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-database-compat.min.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB3SaXUOzDh9_DVbuupon7BsCgZfw5UzZ4",
        authDomain: "myrestaurantapp-a14d4.firebaseapp.com",
        databaseURL: "https://myrestaurantapp-a14d4-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "myrestaurantapp-a14d4",
        storageBucket: "myrestaurantapp-a14d4.firebasestorage.app",
        messagingSenderId: "123788707874",
        appId: "1:123788707874:web:6593b827b284cc7cb9a27b"
    };

    firebase.initializeApp(firebaseConfig);

    // --- VPN ကျော်ရန် အဓိကထည့်ရမည့်အပိုင်း ---
    try {
        const dbRef = firebase.database().ref(".info/connected");
        dbRef.on("value", (snap) => {
            if (snap.val() === false) {
                if (firebase.database.INTERNAL && firebase.database.INTERNAL.forceLongPolling) {
                    firebase.database.INTERNAL.forceLongPolling(true);
                }
            }
        });
    } catch (e) { console.error(e); }
    // ------------------------------------

    const db = firebase.database();
    
    // ကျန်တဲ့ function တွေ (Order ရှာတာ၊ Status ပြတာ) ကို ဒီအောက်မှာ ဆက်ထားပါ



    function loadData() {
        db.ref('menu').on('value', snap => {
            const container = document.getElementById('menu-list-container');
            container.innerHTML = '';
            const data = snap.val();
            if (!data) { container.innerHTML = '<p style="text-align:center; color:gray;">ဟင်းပွဲများ မရှိသေးပါ။</p>'; return; }
            for (let id in data) {
                const item = data[id];
                container.innerHTML += `
                    <div class="menu-item">
                        <img src="${item.image || ''}" class="menu-img" onerror="this.src='https://via.placeholder.com/55'">
                        <div class="menu-info">
                            <div class="menu-name">${item.name || 'Unnamed'}</div>
                            <div class="menu-price">${item.price || 0} Ks</div>
                            <div class="menu-meta">${item.category || '-'} • Stock: ${item.stock || 0}</div>
                        </div>
                        <div class="actions">
                            <i class="fas fa-edit" style="color:var(--primary);" onclick='editItem("${id}", ${JSON.stringify(item)})'></i>
                            <i class="fas fa-trash" style="color:#FF3B30;" onclick="deleteItem('${id}')"></i>
                        </div>
                    </div>`;
            }
        });
    }

    function toggleForm() {
        const f = document.getElementById('form-container');
        f.style.display = (f.style.display === 'block') ? 'none' : 'block';
        if(f.style.display === 'none') resetInputs();
        else window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function saveMenu() {
        const id = document.getElementById('edit-id').value;
        const obj = {
            name: document.getElementById('mName').value,
            price: document.getElementById('mPrice').value,
            stock: document.getElementById('mStock').value,
            category: document.getElementById('mCat').value,
            image: document.getElementById('mImg').value
        };
        if(!obj.name || !obj.price) return alert("အမည်နှင့် ဈေးနှုန်းထည့်ပါ");
        const ref = id ? db.ref('menu/'+id) : db.ref('menu').push();
        ref.set(obj).then(() => toggleForm());
    }

    function editItem(id, data) {
        document.getElementById('edit-id').value = id;
        document.getElementById('mName').value = data.name;
        document.getElementById('mPrice').value = data.price;
        document.getElementById('mStock').value = data.stock;
        document.getElementById('mCat').value = data.category;
        document.getElementById('mImg').value = data.image;
        document.getElementById('form-title').innerText = "ဟင်းပွဲပြင်ဆင်ရန်";
        document.getElementById('form-container').style.display = 'block';
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function deleteItem(id) { if(confirm("ဖျက်မှာလား?")) db.ref('menu/'+id).remove(); }
    function resetInputs() {
        document.getElementById('edit-id').value = "";
        document.getElementById('mName').value = "";
        document.getElementById('mPrice').value = "";
        document.getElementById('mStock').value = "";
        document.getElementById('mCat').value = "";
        document.getElementById('mImg').value = "";
        document.getElementById('form-title').innerText = "ဟင်းပွဲအသစ်ထည့်ရန်";
    }

    window.onload = loadData;
</script>
</body>
</html>

