<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YNS Kitchen - Menu</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --pearl: #ffffff; --bg: #F8F9FC; --primary: #007AFF; --text: #1C1C1E; --gray: #8E8E93; --red: #FF3B30; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 120px; }

        /* Header UI */
        .header { background: var(--pearl); padding: 15px 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .top-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; }
        .back-link { text-decoration: none; color: var(--text); font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .user-status { display: flex; align-items: center; gap: 10px; }
        .user-status img { width: 32px; height: 32px; border-radius: 50%; border: 1px solid #eee; }

        /* Modern Official Google Button */
        .g-btn {
            display: flex; align-items: center; justify-content: center; gap: 12px;
            width: 100%; height: 48px; background: white; 
            border: 1px solid #747775; border-radius: 24px; 
            font-weight: 600; font-size: 14px; cursor: pointer;
            margin: 20px 0 10px; transition: 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .g-btn:active { background: #f1f3f4; transform: scale(0.98); }
        .g-btn img { width: 20px; height: 20px; }

        /* Login Modal (BottomSheet Style) */
        .login-modal { 
            display: none; position: fixed; inset: 0; 
            background: rgba(0,0,0,0.5); z-index: 2000; 
            align-items: flex-end; justify-content: center; 
        }
        .login-card { 
            background: white; width: 100%; border-radius: 30px 30px 0 0; 
            padding: 30px 25px; text-align: center; 
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* Menu UI */
        .search-box { background: #F2F2F7; border-radius: 12px; padding: 10px 15px; display: flex; align-items: center; gap: 10px; }
        .search-box input { border: none; background: none; outline: none; width: 100%; font-size: 14px; }
        .menu-container { padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .food-card { background: white; border-radius: 20px; padding: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.02); }
        .food-img { width: 100%; height: 110px; border-radius: 15px; object-fit: cover; }
        .food-name { font-weight: 700; font-size: 14px; margin: 8px 0 4px; display: block; height: 35px; overflow: hidden; }
        .food-price { color: var(--primary); font-weight: 800; font-size: 13px; display: block; margin-bottom: 10px; }
        .add-btn { background: var(--primary); color: white; border: none; width: 100%; padding: 10px; border-radius: 12px; font-weight: 700; cursor: pointer; }

        /* Floating Cart Bar */
        .cart-bar { position: fixed; bottom: 20px; left: 15px; right: 15px; background: var(--text); color: white; padding: 15px 20px; border-radius: 22px; display: none; justify-content: space-between; align-items: center; z-index: 500; }

        /* Cart Modal */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: flex-end; }
        .modal-content { background: white; width: 100%; border-radius: 30px 30px 0 0; padding: 25px; max-height: 85vh; overflow-y: auto; box-sizing: border-box; }
        .cart-item { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid #F2F2F7; }
        .qty-input { width: 30px; text-align: center; border: none; font-weight: 800; background: transparent; }
        .submit-btn { background: var(--primary); color: white; border: none; width: 100%; padding: 16px; border-radius: 15px; font-weight: 800; margin-top: 15px; width: 100%; }
        .qty-btn { border: none; background: #f2f2f7; width: 28px; height: 28px; border-radius: 8px; font-weight: 800; color: var(--primary); cursor: pointer; }
    </style>
</head>
<body>

    <div id="login-modal" class="login-modal">
        <div class="login-card">
            <div style="width: 40px; height: 5px; background: #eee; border-radius: 5px; margin: 0 auto 20px;"></div>
            <h3 style="margin:0; font-size: 18px; font-weight: 800;">Login Required</h3>
            <p style="color: var(--gray); font-size: 14px; margin: 10px 0;">ခြင်းတောင်းထဲထည့်ရန် Google Login အရင်ဝင်ပါ</p>
            
            <button class="g-btn" onclick="startGoogleLogin()">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_Color_Icon.svg" alt="Google">
                Sign in with Google
            </button>
            
            <button onclick="closeLoginModal()" style="border:none; background:none; color:var(--gray); font-weight:700; padding:10px; cursor:pointer;">မဝင်သေးပါ</button>
        </div>
    </div>

    <div class="header">
        <div class="top-nav">
            <a href="index.html" class="back-link"><i class="fas fa-arrow-left"></i> Home</a>
            <div id="auth-status" class="user-status">
                <span style="font-size:11px; color:var(--gray);">Guest Mode</span>
            </div>
        </div>
        <div class="search-box">
            <i class="fas fa-search" style="color:var(--gray)"></i>
            <input type="text" id="search" placeholder="Search menu..." oninput="filterItems()">
        </div>
    </div>

    <div id="menu-display" class="menu-container"></div>

    <div class="cart-bar" id="cart-bar">
        <div><b id="total-ks">0 Ks</b><br><span id="total-items" style="font-size:11px">0 items</span></div>
        <button onclick="toggleModal(true)" style="background:var(--primary); color:white; border:none; padding:10px 22px; border-radius:14px; font-weight:700;">View Cart</button>
    </div>

    <div class="modal" id="cart-modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h2 style="margin:0;">Cart Items</h2>
                <i class="fas fa-times" onclick="toggleModal(false)" style="font-size:22px; color:var(--gray); cursor:pointer;"></i>
            </div>
            <div id="cart-items-list"></div>
            <div class="form-group" style="margin-top:20px;">
                <div style="display:flex; justify-content:space-between; padding: 15px 0; border-top: 1px dashed #eee;">
                    <b>Total Price</b> <b id="modal-total" style="color: var(--primary);">0 Ks</b>
                </div>
                <input type="text" id="o-name" placeholder="Name" style="width:100%; padding:14px; margin-bottom:10px; border:1px solid #E5E5EA; border-radius:12px; box-sizing:border-box;">
                <input type="tel" id="o-phone" placeholder="Phone (09xxxxxxx)" style="width:100%; padding:14px; margin-bottom:15px; border:1px solid #E5E5EA; border-radius:12px; box-sizing:border-box;">
                <button class="submit-btn" id="submit-btn" onclick="sendOrder()">Confirm Order</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-database-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-auth-compat.min.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB3SaXUOzDh9_DVbuupon7BsCgZfw5UzZ4",
            authDomain: "myrestaurantapp-a14d4.firebaseapp.com",
            databaseURL: "https://myrestaurantapp-a14d4-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "myrestaurantapp-a14d4",
            storageBucket: "myrestaurantapp-a14d4.firebasestorage.app",
            messagingSenderId: "123788707874",
            appId: "1:123788707874:web:6593b827b284cc7cb9a27b"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();
        let menuData = []; let cart = {}; let currentUser = null; let pendingItem = null;

        // Login Auth Listener
        auth.onAuthStateChanged(user => {
            currentUser = user;
            const statusDiv = document.getElementById('auth-status');
            if(user) {
                statusDiv.innerHTML = `
                    <img src="${user.photoURL}">
                    <div style="text-align:right">
                        <b style="font-size:11px; display:block; max-width: 80px; overflow: hidden; white-space: nowrap;">${user.displayName}</b>
                        <span style="font-size:9px; color:var(--red); font-weight:800;" onclick="auth.signOut()">Logout</span>
                    </div>`;
                document.getElementById('o-name').value = user.displayName;
                if(pendingItem) { executeAddToCart(pendingItem); pendingItem = null; }
            } else {
                statusDiv.innerHTML = `<span style="font-size:11px; color:var(--gray); font-weight: 700;">Guest Mode</span>`;
            }
        });

        function handleAddToCart(id) {
            if(currentUser) executeAddToCart(id);
            else { pendingItem = id; document.getElementById('login-modal').style.display = 'flex'; }
        }

        function closeLoginModal() { document.getElementById('login-modal').style.display = 'none'; pendingItem = null; }

        async function startGoogleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                await auth.signInWithPopup(provider);
                closeLoginModal();
            } catch (e) { alert("Login failed."); }
        }

        function executeAddToCart(id) {
            const i = menuData.find(m => m.id === id);
            if(!cart[id]) cart[id] = { name: i.name, price: i.price, image: i.image, qty: 1 };
            else cart[id].qty++;
            updateCartBar();
        }

        function init() {
            db.ref('menu').on('value', snap => {
                const data = snap.val(); menuData = [];
                if(data) { for(let id in data) menuData.push({...data[id], id}); }
                renderMenu(menuData);
            });
        }

        function renderMenu(items) {
            document.getElementById('menu-display').innerHTML = items.map(i => `
                <div class="food-card">
                    <img src="${i.image || 'https://via.placeholder.com/150'}" class="food-img">
                    <b class="food-name">${i.name}</b>
                    <span class="food-price">${parseInt(i.price).toLocaleString()} Ks</span>
                    <button class="add-btn" onclick="handleAddToCart('${i.id}')">Add to Cart</button>
                </div>
            `).join('');
        }

        function updateCartBar() {
            const qty = Object.values(cart).reduce((s, i) => s + i.qty, 0);
            const amt = Object.values(cart).reduce((s, i) => s + (i.qty * i.price), 0);
            const bar = document.getElementById('cart-bar');
            if(qty > 0) {
                bar.style.display = 'flex';
                document.getElementById('total-ks').innerText = amt.toLocaleString() + " Ks";
                document.getElementById('total-items').innerText = qty + " items";
                document.getElementById('modal-total').innerText = amt.toLocaleString() + " Ks";
            } else { bar.style.display = 'none'; toggleModal(false); }
        }

        function renderCartList() {
            let html = "";
            for(let id in cart) {
                const i = cart[id];
                html += `<div class="cart-item">
                    <div style="flex:1"><b>${i.name}</b><br><span style="font-size:12px; color:var(--primary)">${(i.qty*i.price).toLocaleString()} Ks</span></div>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <button class="qty-btn" onclick="updateQty('${id}',-1)">-</button>
                        <span class="qty-input">${i.qty}</span>
                        <button class="qty-btn" onclick="updateQty('${id}',1)">+</button>
                    </div>
                </div>`;
            }
            document.getElementById('cart-items-list').innerHTML = html;
        }

        function updateQty(id, d) { cart[id].qty += d; if(cart[id].qty <= 0) delete cart[id]; updateCartBar(); renderCartList(); }
        function toggleModal(s) { document.getElementById('cart-modal').style.display = s?'flex':'none'; if(s) renderCartList(); }

        function sendOrder() {
            const n = document.getElementById('o-name').value;
            const p = document.getElementById('o-phone').value;
            if(!n || !p) return alert("အချက်အလက်ဖြည့်ပါ");
            
            const orderId = "ORD" + Math.floor(1000 + Math.random() * 9000);
            const order = {
                orderId: orderId,
                deviceUID: currentUser.uid,
                customerName: n, customerPhone: p,
                items: Object.values(cart),
                total: Object.values(cart).reduce((s, i) => s + (i.qty * i.price), 0),
                status: "Pending",
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };

            db.ref('orders').push(order).then(() => {
                alert("Order တင်ပြီးပါပြီ!"); window.location.href = "track.html";
            });
        }
        function filterItems() {
            const val = document.getElementById('search').value.toLowerCase();
            renderMenu(menuData.filter(m => m.name.toLowerCase().includes(val)));
        }
        window.onload = init;
    </script>
</body>
</html>

