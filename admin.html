<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4takeaway Admin - MYIN THAR ROAST</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #e91e63;
            --sidebar-bg: #ffffff;
            --main-bg: #f8f9fc;
            --dark-blue: #001f3f;
            --text-gray: #858796;
        }

        body { font-family: 'Inter', 'Pyidaungsu', sans-serif; background: var(--main-bg); margin: 0; display: flex; color: #333; }
        
        /* Sidebar Styles */
        .sidebar { width: 260px; background: var(--sidebar-bg); height: 100vh; position: fixed; border-right: 1px solid #e3e6f0; padding: 20px; z-index: 1000; overflow-y: auto; transition: 0.3s; }
        .brand { color: var(--primary); font-size: 24px; font-weight: 800; margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        .nav-header { font-size: 11px; font-weight: 700; color: #b7b9cc; text-transform: uppercase; margin: 20px 0 10px 10px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 15px; text-decoration: none; color: #4e73df; border-radius: 10px; margin-bottom: 5px; cursor: pointer; transition: 0.2s; font-size: 14px; }
        .nav-item:hover, .nav-item.active { background: #fff0f3; color: var(--primary); }

        /* Main Content */
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 30px; transition: 0.3s; }
        .topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }

        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1); border-left: 4px solid var(--primary); }
        .card h6 { margin: 0; font-size: 11px; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; }
        .card h2 { margin: 10px 0 0; font-size: 22px; color: #5a5c69; }

        /* Order Table Fashion */
        .section-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1); margin-bottom: 30px; }
        .card-header { background: var(--dark-blue); color: white; padding: 15px 20px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fc; padding: 15px; text-align: left; font-size: 13px; color: var(--text-gray); border-bottom: 1px solid #e3e6f0; }
        td { padding: 15px; border-bottom: 1px solid #e3e6f0; font-size: 14px; }
        .status-badge { padding: 5px 10px; border-radius: 5px; font-size: 11px; font-weight: bold; }
        .status-new { background: #ffeaa7; color: #d35400; }

        /* Forms & Buttons */
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-size: 13px; font-weight: 600; }
        input, select { width: 100%; padding: 12px; border: 1px solid #d1d3e2; border-radius: 10px; }
        .btn-primary { background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: bold; }

        /* Notification Alarm Banner */
        #alarm-banner { display: none; background: #e74c3c; color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 2000; font-weight: bold; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar { left: -260px; }
            .sidebar.active { left: 0; }
            .main-content { margin-left: 0; width: 100%; padding: 15px; }
        }
    </style>
</head>
<body>

<audio id="orderAlarm" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" loop></audio>
<div id="alarm-banner">⚠️ အော်ဒါအသစ်ဝင်လာပါပြီ! <button onclick="stopAlarm()" style="padding:5px; cursor:pointer;">ပိတ်မည်</button></div>

<div class="sidebar" id="sidebar">
    <div class="brand"><i class="fas fa-rocket"></i> 4takeaway</div>
    
    <div class="nav-item active" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</div>
    <div class="nav-item" onclick="showSection('orders')"><i class="fas fa-shopping-cart"></i> Orders Details</div>
    
    <div class="nav-header">Users</div>
    <div class="nav-item"><i class="fas fa-users"></i> Employees</div>
    <div class="nav-item"><i class="fas fa-user"></i> End user</div>

    <div class="nav-header">Admin</div>
    <div class="nav-item" onclick="showSection('menu')"><i class="fas fa-plus-circle"></i> Add Menu Item</div>
    <div class="nav-item" onclick="showSection('analysis')"><i class="fas fa-chart-line"></i> Finance / Analysis</div>
    <div class="nav-item"><i class="fas fa-cog"></i> System Settings</div>
</div>

<div class="main-content">
    <div class="topbar">
        <h2 id="section-title" style="font-size: 22px; color: #5a5c69;">Dashboard</h2>
        <div style="display:flex; align-items:center; gap:20px;">
            <i class="fas fa-search color-muted"></i>
            <i class="fas fa-bell color-muted"></i>
            <img src="https://ui-avatars.com/api/?name=Admin&background=e91e63&color=fff" style="width:35px; border-radius:50%;">
        </div>
    </div>

    <div id="dashboard-section">
        <div class="stats-grid">
            <div class="card"><h6>Total Orders</h6><h2 id="stat-count">0</h2></div>
            <div class="card"><h6>Earnings (Today)</h6><h2 id="stat-revenue">0 K</h2></div>
            <div class="card"><h6>Unpaid Orders</h6><h2>0</h2></div>
            <div class="card"><h6>Completed</h6><h2>0</h2></div>
        </div>

        <div class="section-card">
            <div class="card-header">
                <span>Recent Orders</span>
                <i class="fas fa-ellipsis-v"></i>
            </div>
            <table>
                <thead>
                    <tr><th>Order No</th><th>Name</th><th>Items</th><th>Total</th><th>Status</th></tr>
                </thead>
                <tbody id="order-rows"></tbody>
            </table>
        </div>
    </div>

    <div id="menu-section" style="display:none;">
        <div class="card" style="max-width: 600px;">
            <h3 style="margin-top:0;">Add New Food Product</h3>
            <div class="form-group">
                <label>Food Name</label>
                <input type="text" id="m-name" placeholder="e.g. BBQ Chicken">
            </div>
            <div class="form-group">
                <label>Price (MMK)</label>
                <input type="number" id="m-price" placeholder="5000">
            </div>
            <button class="btn-primary" onclick="addMenuItem()">Save Product</button>
        </div>
    </div>

    <div id="analysis-section" style="display:none;">
        <div class="card">
            <h3>Sales Growth Analysis</h3>
            <canvas id="salesChart" height="100"></canvas>
        </div>
    </div>
</div>

<script>
    const SB_URL = "https://iogpnvljnhsxuzzdltpb.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvZ3BudmxqbmhzeHV6emRsdHBiIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2Njc1OTYwNiwiZXhwIjoyMDgyMzM1NjA2fQ.rNXHHO8PKO58ZXR4Eqzi6Bl0vzCIwH24jiwOVwbVPoc";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    let lastId = 0;

    function showSection(name) {
        document.querySelectorAll('.main-content > div:not(.topbar)').forEach(d => d.style.display = 'none');
        document.getElementById(`${name}-section`).style.display = 'block';
        document.getElementById('section-title').innerText = name.charAt(0).toUpperCase() + name.slice(1);
        if(name === 'analysis') renderChart();
    }

    async function fetchAll() {
        const { data } = await _supabase.from('orders').select('*').order('created_at', { ascending: false });
        if(data) {
            document.getElementById('order-rows').innerHTML = data.map(o => `
                <tr>
                    <td>#${o.id.toString().slice(-5)}</td>
                    <td><b>${o.customer_name}</b></td>
                    <td style="font-size:12px;">${o.items}</td>
                    <td>${o.total} K</td>
                    <td><span class="status-badge status-new">${o.status}</span></td>
                </tr>
            `).join('');
            document.getElementById('stat-count').innerText = data.length;
            let revenue = data.reduce((acc, o) => acc + parseInt(o.total.replace(/,/g, '')), 0);
            document.getElementById('stat-revenue').innerText = revenue.toLocaleString() + " K";
            
            if(lastId !== 0 && data[0].id > lastId) {
                document.getElementById('orderAlarm').play();
                document.getElementById('alarm-banner').style.display = 'block';
            }
            lastId = data[0].id;
        }
    }

    async function addMenuItem() {
        const name = document.getElementById('m-name').value;
        const price = document.getElementById('m-price').value;
        const { error } = await _supabase.from('menu_items').insert([{ name, price: parseInt(price), is_available: true }]);
        if(!error) alert("Product Added!");
    }

    function renderChart() {
        const ctx = document.getElementById('salesChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{ label: 'Sales MMK', data: [30000, 45000, 32000, 70000, 85000, 120000, 150000], borderColor: '#e91e63', tension: 0.3 }]
            }
        });
    }

    function stopAlarm() {
        document.getElementById('orderAlarm').pause();
        document.getElementById('alarm-banner').style.display = 'none';
    }

    window.onload = () => { fetchAll(); setInterval(fetchAll, 5000); };
</script>
</body>
</html>
